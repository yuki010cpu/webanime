<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Streaming - Professional Live Streaming Site</title>
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome via CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#1e40af',
                        dark: '#111827'
                    }
                }
            }
        }
    </script>
    <!-- Custom CSS for scrollbar and animations -->
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #1e40af;
        }
        /* Hover animations */
        .anime-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .anime-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-dark text-white">
    <div id="root"></div>

    <!-- React, ReactDOM, Axios via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Main React App Script -->
    <script type="text/babel">
        // Import React hooks
        const { useState, useEffect } = React;

        // Loading Component
        const Loading = () => (
            <div className="flex justify-center items-center py-10">
                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
            </div>
        );

        // Error Component
        const Error = ({ message }) => (
            <div className="text-center py-10 text-red-500">
                <i className="fas fa-exclamation-triangle text-4xl mb-4"></i>
                <p>{message}</p>
            </div>
        );

        // Header Component
        const Header = ({ setView, setSelectedAnime }) => (
            <header className="bg-secondary p-4 shadow-lg">
                <div className="container mx-auto flex justify-between items-center">
                    <div className="flex items-center">
                        <i className="fas fa-play-circle text-primary text-2xl mr-2"></i>
                        <h1 className="text-xl font-bold">AnimeStream</h1>
                    </div>
                    <nav className="space-x-4">
                        <button onClick={() => { setView('list'); setSelectedAnime(null); }} className="hover:text-primary">Beranda</button>
                        <button onClick={() => { setView('list'); setSelectedAnime(null); }} className="hover:text-primary">Daftar Anime</button>
                        <button className="hover:text-primary">Jadwal</button>
                        <button className="hover:text-primary">Genre</button>
                    </nav>
                </div>
            </header>
        );

        // Footer Component
        const Footer = () => (
            <footer className="bg-secondary p-4 mt-10">
                <div className="container mx-auto text-center">
                    <p>&copy; 2023 AnimeStream. All rights reserved.</p>
                    <div className="flex justify-center space-x-4 mt-2">
                        <a href="#" className="hover:text-primary"><i className="fab fa-facebook"></i></a>
                        <a href="#" className="hover:text-primary"><i className="fab fa-twitter"></i></a>
                        <a href="#" className="hover:text-primary"><i className="fab fa-instagram"></i></a>
                        <a href="#" className="hover:text-primary"><i className="fas fa-envelope"></i></a>
                    </div>
                </div>
            </footer>
        );

        // AnimeCard Component
        const AnimeCard = ({ anime, onClick }) => (
            <div className="anime-card bg-gray-800 rounded-lg overflow-hidden cursor-pointer" onClick={() => onClick(anime)}>
                <img src={anime.thumbnail} alt={anime.title} className="w-full h-48 object-cover" />
                <div className="p-4">
                    <h3 className="font-bold text-lg truncate">{anime.title}</h3>
                    <p className="text-sm text-gray-400">Episode: {anime.episode}</p>
                    <p className="text-sm text-gray-400">Rating: {anime.rating}</p>
                    <p className="text-sm text-gray-400">Upload: {anime.uploadDate}</p>
                    <p className="text-sm text-gray-400">Status: {anime.status}</p>
                    <p className="text-sm text-gray-400">Genre: {anime.genre.join(', ')}</p>
                    <p className="text-sm text-gray-400 truncate">{anime.sinopsis}</p>
                </div>
            </div>
        );

        // AnimeList Component
        const AnimeList = ({ animes, onAnimeClick, loading, error }) => {
            if (loading) return <Loading />;
            if (error) return <Error message={error} />;

            return (
                <div className="container mx-auto p-4">
                    <h2 className="text-2xl font-bold mb-6">Daftar Anime</h2>
                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                        {animes.map(anime => (
                            <AnimeCard key={anime.id || anime.title} anime={anime} onClick={onAnimeClick} />
                        ))}
                    </div>
                </div>
            );
        };

        // AnimeDetail Component
        const AnimeDetail = ({ anime, onBack }) => (
            <div className="container mx-auto p-4">
                <button onClick={onBack} className="mb-4 bg-primary px-4 py-2 rounded hover:bg-secondary">Kembali</button>
                <div className="bg-gray-800 rounded-lg p-6">
                    <img src={anime.thumbnail} alt={anime.title} className="w-full h-64 object-cover rounded mb-4" />
                    <h2 className="text-3xl font-bold mb-2">{anime.title}</h2>
                    <p className="mb-2"><strong>Sinopsis:</strong> {anime.sinopsis}</p>
                    <p className="mb-2"><strong>Genre:</strong> {anime.genre.join(', ')}</p>
                    <p className="mb-2"><strong>Episode:</strong> {anime.episode}</p>
                    <p className="mb-2"><strong>Status:</strong> {anime.status}</p>
                    <p className="mb-2"><strong>Rating:</strong> {anime.rating}</p>
                    <p className="mb-2"><strong>Upload Date:</strong> {anime.uploadDate}</p>
                    <h3 className="text-xl font-bold mt-6 mb-4">Episodes</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {anime.episodes && anime.episodes.map(ep => (
                            <div key={ep.id} className="bg-gray-700 p-4 rounded">
                                <p>{ep.title}</p>
                                <a href={ep.url} className="text-primary hover:underline">Watch</a>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        // Sidebar Component (Optional: Filter by genre and status)
        const Sidebar = ({ genres, statuses, selectedGenre, selectedStatus, onGenreChange, onStatusChange }) => (
            <aside className="w-64 bg-gray-800 p-4">
                <h3 className="text-lg font-bold mb-4">Filter</h3>
                <div className="mb-4">
                    <label className="block mb-2">Genre:</label>
                    <select value={selectedGenre} onChange={e => onGenreChange(e.target.value)} className="w-full bg-gray-700 p-2 rounded">
                        <option value="">All</option>
                        {genres.map(genre => <option key={genre} value={genre}>{genre}</option>)}
                    </select>
                </div>
                <div>
                    <label className="block mb-2">Status:</label>
                    <select value={selectedStatus} onChange={e => onStatusChange(e.target.value)} className="w-full bg-gray-700 p-2 rounded">
                        <option value="">All</option>
                        {statuses.map(status => <option key={status} value={status}>{status}</option>)}
                    </select>
                </div>
            </aside>
        );

        // Main App Component
        const App = () => {
            const [animes, setAnimes] = useState([]);
            const [filteredAnimes, setFilteredAnimes] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [view, setView] = useState('list'); // 'list' or 'detail'
            const [selectedAnime, setSelectedAnime] = useState(null);
            const [selectedGenre, setSelectedGenre] = useState('');
            const [selectedStatus, setSelectedStatus] = useState('');
            const [genres, setGenres] = useState([]);
            const [statuses, setStatuses] = useState([]);

            // Fetch data from API
            useEffect(() => {
                axios.get('https://wajik-anime-api.vercel.app/samehadaku')
                    .then(response => {
                        const data = response.data;
                        setAnimes(data);
                        setFilteredAnimes(data);
                        // Extract unique genres and statuses
                        const allGenres = [...new Set(data.flatMap(anime => anime.genre))];
                        const allStatuses = [...new Set(data.map(anime => anime.status))];
                        setGenres(allGenres);
                        setStatuses(allStatuses);
                        setLoading(false);
                    })
                    .catch(err => {
                        setError('Failed to fetch anime data. Please try again.');
                        setLoading(false);
                    });
            }, []);

            // Filter animes based on selected genre and status
            useEffect(() => {
                let filtered = animes;
                if (selectedGenre) {
                    filtered = filtered.filter(anime => anime.genre.includes(selectedGenre));
                }
                if (selectedStatus) {
                    filtered = filtered.filter(anime => anime.status === selectedStatus);
                }
                setFilteredAnimes(filtered);
            }, [animes, selectedGenre, selectedStatus]);

            const handleAnimeClick = (anime) => {
                setSelectedAnime(anime);
                setView('detail');
            };

            const handleBack = () => {
                setView('list');
                setSelectedAnime(null);
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <Header setView={setView} setSelectedAnime={setSelectedAnime} />
                    <div className="flex flex-1">
                        <Sidebar 
                            genres={genres} 
                            statuses={statuses} 
                            selectedGenre={selectedGenre} 
                            selectedStatus={selectedStatus} 
                            onGenreChange={setSelectedGenre} 
                            onStatusChange={setSelectedStatus} 
                        />
                        <main className="flex-1">
                            {view === 'list' ? (
                                <AnimeList animes={filteredAnimes} onAnimeClick={handleAnimeClick} loading={loading} error={error} />
                            ) : (
                                <AnimeDetail anime={selectedAnime} onBack={handleBack} />
                            )}
                        </main>
                    </div>
                    <Footer />
                </div>
            );
        };

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
